# TakeABreath API Documentation

## ê°œìš”

TakeABreath í”„ë¡œì íŠ¸ì˜ í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ í†µì‹ ì„ ìœ„í•œ API ëª…ì„¸ì„œì…ë‹ˆë‹¤.

## API ì—”ë“œí¬ì¸íŠ¸

### 1. ì²« ë©”ì‹œì§€ ì „ì†¡

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/records/start/`

**ìš”ì²­ (Request)**:

```json
{
  "message": "ì˜¤ëŠ˜ ë„ˆë¬´ í˜ë“¤ì—ˆì–´",
  "role": "user"
}
```

**ì‘ë‹µ (Response)**:

```json
{
  "chat_session_id": 1,
  "answer": "ì–´ ì™œ",
  "time": "21:19",
  "date": "2025-08-08"
}
```

**ì„¤ëª…**:

- MainPageì—ì„œ ì²« ë©”ì‹œì§€ë¥¼ ì „ì†¡í•  ë•Œ ì‚¬ìš©
- `role`ì€ í•­ìƒ "user"ë¡œ ê³ ì •
- ì‘ë‹µìœ¼ë¡œ ì±„íŒ… ì„¸ì…˜ IDì™€ AI ì‘ë‹µì„ ë°›ìŒ

---

### 2. ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/chats/attach/`

**ìš”ì²­ (Request)**:

```json
{
  "chat_session_id": 1,
  "evidence": null,
  "text": "ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë©”ì‹œì§€"
}
```

**ì‘ë‹µ (Response)**:

```json
{
  "answer": "ì–´ ê³ ìƒí–ˆì–´",
  "time": "21:19",
  "date": "2025-08-08"
}
```

**ì„¤ëª…**:

- ChatPageì—ì„œ ì±„íŒ… ë©”ì‹œì§€ë¥¼ ì „ì†¡í•  ë•Œ ì‚¬ìš©
- `evidence`: íŒŒì¼ ì²¨ë¶€ (í˜„ì¬ëŠ” null)
- `text`: ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë©”ì‹œì§€ ë‚´ìš©

---

### 3. ê¸°ë¡ ì™„ë£Œ

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/chats/end/`

**ìš”ì²­ (Request)**:

```json
{
  "chat_session_id": 1
}
```

**ì‘ë‹µ (Response)**:

```json
{
  "record_id": 3,
  "title": "ë™ë°©ì—ì„œ ì¼ì–´ë‚œ ë¬´ì‹œë¬´ì‹œí•œ ì‚¬ê±´",
  "category": ["ê´´ë¡­í˜"],
  "content": "ì˜¤ëŠ˜ í•´ìŠ¹ì´ê°€ í•´ì›ì´ë¥¼ ê´´ë¡­í˜”ë‹¤",
  "severity": 1,
  "location": "ë™ë°©",
  "created_at": "2025-08-05T10:00:00",
  "occurred_at": "2025-08-01T14:30:00",
  "assailant": ["ì„œí•´ìŠ¹", "ì´ì˜ˆë¦¼"],
  "witness": ["ì˜¤ì˜ë¡"],
  "drawers": ["00 ì»¤í”¼ í­ì–¸", "ê¸°ì°¨ì—­ ì‚´ì¸ì‚¬ê±´"],
  "evidences": [
    {
      "filename": "í•´ì›ì´ ìš•ì„¤ íŒŒì¼",
      "type": "audio",
      "url": "url~~"
    },
    {
      "filename": "í­í–‰ ë‹¹ì‹œ ì‚¬ì§„",
      "type": "image",
      "url": "url2~~"
    }
  ]
}
```

**ì„¤ëª…**:

- ChatPageì—ì„œ "ê¸°ë¡ ë§ˆì¹˜ê¸°" ë²„íŠ¼ í´ë¦­ ì‹œ ì‚¬ìš©
- ì±„íŒ… ì„¸ì…˜ì„ ì¢…ë£Œí•˜ê³  ê¸°ë¡ì„ ì™„ë£Œ
- ìƒì„¸í•œ ì‚¬ê±´ ì •ë³´ì™€ ì¦ê±° ìë£Œë¥¼ í¬í•¨í•œ ì‘ë‹µ

---

## ğŸ”„ í˜„ì¬ í•˜ë“œì½”ë”©ëœ ë”ë¯¸ ë°ì´í„° (API ì—°ë™ í•„ìš”)

### 1. DrawerPage - ê¸°ë¡ ëª©ë¡

**í˜„ì¬ í•˜ë“œì½”ë”©ëœ ë°ì´í„°**:

```jsx
<TableRow
  id="1"
  order="1"
  title="00ì»¤í”¼ ì‚¬ì¥ë‹˜ ë§‰ë§"
  date="2025. 8. 3."
  location="ìƒë„ë™ 00 ì»¤í”¼"
  folder="ìƒë„ë™"
/>
<TableRow
  id="2"
  order="2"
  title="00 ì»¤í”¼ ì‚¬ì¥ë‹˜ ë¬´ì•ˆ ì¤Œ"
  date="2025. 7. 12."
  location="ìƒë„ë™ 00 ì»¤í”¼"
  folder="ìƒë„ë™"
/>
```

**í•„ìš”í•œ API**:

- `GET /api/records/` - ê¸°ë¡ ëª©ë¡ ì¡°íšŒ
- `GET /api/records/{id}/` - ê¸°ë¡ ìƒì„¸ ì¡°íšŒ
- `DELETE /api/records/{id}/` - ê¸°ë¡ ì‚­ì œ

---

### 2. FolderChangeModal - í´ë” ëª©ë¡

**í˜„ì¬ í•˜ë“œì½”ë”©ëœ ë°ì´í„°**:

```javascript
const dummyFolders = [
  { drawer_id: 1, name: "ìƒë„ë™" },
  { drawer_id: 2, name: "íšŒê¸°ë™ í•¨ë°•" },
  { drawer_id: 3, name: "ì‚¬ì¥ë‹˜" },
  { drawer_id: 4, name: "í´ë”2" },
  { drawer_id: 5, name: "ìƒë„ë™ã„´ã…‡ã„¹ã„´ã…‡ã„¹" },
  { drawer_id: 6, name: "ìƒë„ë™ã„´ã…‡ã„¹" },
];
```

**í•„ìš”í•œ API**:

- `GET /api/drawers/list/` - í´ë” ëª©ë¡ ì¡°íšŒ
- `POST /api/drawers/` - ìƒˆ í´ë” ìƒì„±
- `PUT /api/records/{id}/folder/` - ê¸°ë¡ í´ë” ë³€ê²½

---

### 3. ChatPage - ê°€ì§œ API ì‘ë‹µ

**í˜„ì¬ í•˜ë“œì½”ë”©ëœ ì„¤ì •**:

```javascript
const USE_FAKE_API = true; // í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ falseë¡œ ë³€ê²½í•˜ì„¸ìš”
const SIMULATE_LATENCY_MS = 3000;

// ê°€ì§œ ì‘ë‹µ ë°ì´í„°
const mockResponse = {
  answer: "ì–´ ê³ ìƒí–ˆì–´",
  time: "21:19",
  date: "2025-08-08",
};
```

**í•„ìš”í•œ ì‘ì—…**:

- `USE_FAKE_API`ë¥¼ `false`ë¡œ ë³€ê²½
- ì‹¤ì œ API í˜¸ì¶œë¡œ êµì²´

---

### 4. FinishLoadingModal - ê¸°ë¡ ì™„ë£Œ ì‘ë‹µ

**í˜„ì¬ í•˜ë“œì½”ë”©ëœ ë°ì´í„°**:

```javascript
const fallbackData = {
  record_id: 3,
  title: "ë™ë°©ì—ì„œ ì¼ì–´ë‚œ ë¬´ì‹œë¬´ì‹œí•œ ì‚¬ê±´",
  category: ["ê´´ë¡­í˜"],
  content: "ì˜¤ëŠ˜ í•´ìŠ¹ì´ê°€ í•´ì›ì´ë¥¼ ê´´ë¡­í˜”ë‹¤",
  severity: 1,
  location: "ë™ë°©",
  created_at: "2025-08-05T10:00:00",
  occurred_at: "2025-08-01T14:30:00",
  assailant: ["ì„œí•´ìŠ¹", "ì´ì˜ˆë¦¼"],
  witness: ["ì˜¤ì˜ë¡"],
  drawers: ["00 ì»¤í”¼ í­ì–¸", "ê¸°ì°¨ì—­ ì‚´ì¸ì‚¬ê±´"],
  evidences: [
    {
      filename: "í•´ì›ì´ ìš•ì„¤ íŒŒì¼",
      type: "audio",
      url: "url~~",
    },
    {
      filename: "í­í–‰ ë‹¹ì‹œ ì‚¬ì§„",
      type: "image",
      url: "url2~~",
    },
  ],
};
```

**í•„ìš”í•œ API**:

- `POST /api/chats/end/` - ê¸°ë¡ ì™„ë£Œ (ì´ë¯¸ ì •ì˜ë¨)

---

### 5. MainPage - Fallback ì‘ë‹µ

**í˜„ì¬ í•˜ë“œì½”ë”©ëœ ë°ì´í„°**:

```javascript
const fallbackResponse = {
  chat_session_id: 1,
  answer: "í•´ë‹¹ ë©”ì„¸ì§€ê°€ ì „ì†¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤",
  time: "21:19",
  date: "2025-08-08",
};
```

**ì„¤ëª…**:

- ì„œë²„ ì˜¤í”„ë¼ì¸ ì‹œ ì‚¬ìš©ë˜ëŠ” fallback ì‘ë‹µ
- ì‹¤ì œ API ì—°ë™ í›„ì—ë„ ì—ëŸ¬ ì²˜ë¦¬ìš©ìœ¼ë¡œ ìœ ì§€ í•„ìš”

---

## ğŸ“‹ ì¶”ê°€ë¡œ í•„ìš”í•œ API ì—”ë“œí¬ì¸íŠ¸

### 1. ê¸°ë¡ ê´€ë¦¬ API

**ê¸°ë¡ ëª©ë¡ ì¡°íšŒ**

- `GET /api/records/`
- `GET /api/records/?folder={folder_id}`
- `GET /api/records/?page={page}&limit={limit}`

**ê¸°ë¡ ìƒì„¸ ì¡°íšŒ**

- `GET /api/records/{id}/`

**ê¸°ë¡ ì‚­ì œ**

- `DELETE /api/records/{id}/`

**ê¸°ë¡ ìˆ˜ì •**

- `PUT /api/records/{id}/`

### 2. í´ë” ê´€ë¦¬ API

**í´ë” ëª©ë¡ ì¡°íšŒ**

- `GET /api/drawers/list/`

**í´ë” ìƒì„±**

- `POST /api/drawers/`
- Body: `{ "name": "í´ë”ëª…" }`

**í´ë” ìˆ˜ì •**

- `PUT /api/drawers/{id}/`
- Body: `{ "name": "ìƒˆ í´ë”ëª…" }`

**í´ë” ì‚­ì œ**

- `DELETE /api/drawers/{id}/`

**ê¸°ë¡ í´ë” ë³€ê²½**

- `PUT /api/records/{id}/folder/`
- Body: `{ "drawer_id": 1 }`

### 3. íŒŒì¼ ê´€ë¦¬ API

**íŒŒì¼ ì—…ë¡œë“œ**

- `POST /api/evidences/upload/`
- Content-Type: `multipart/form-data`

**íŒŒì¼ ë‹¤ìš´ë¡œë“œ**

- `GET /api/evidences/{id}/download/`

**íŒŒì¼ ì‚­ì œ**

- `DELETE /api/evidences/{id}/`

---

## ì—ëŸ¬ ì²˜ë¦¬

### ì„œë²„ ì˜¤í”„ë¼ì¸ ì‹œ Fallback ì‘ë‹µ

```json
{
  "chat_session_id": 1,
  "answer": "í•´ë‹¹ ë©”ì„¸ì§€ê°€ ì „ì†¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤",
  "time": "21:19",
  "date": "2025-08-08"
}
```

### ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ì‹œ

- ì½˜ì†”ì— ì—ëŸ¬ ë¡œê·¸ ì¶œë ¥
- ì‚¬ìš©ìì—ê²Œ fallback ë©”ì‹œì§€ í‘œì‹œ
- ì•± íë¦„ì€ ì •ìƒì ìœ¼ë¡œ ìœ ì§€

---

## í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ ìƒíƒœ

### âœ… ì™„ì„±ëœ ê¸°ëŠ¥

1. MainPage â†’ ChatPage ì „í™˜ (ì²« ë©”ì‹œì§€)
2. ChatPage ì±„íŒ… ê¸°ëŠ¥ (ë©”ì‹œì§€ ì „ì†¡)
3. ê¸°ë¡ ì™„ë£Œ ê¸°ëŠ¥ (ê¸°ë¡ ë§ˆì¹˜ê¸°)
4. ë¡œë”© ìƒíƒœ í‘œì‹œ ("ì‘ë‹µ ì¤‘ì…ë‹ˆë‹¤", "ê¸°ë¡ ì™„ë£Œ ì¤‘...")
5. ìë™ ìŠ¤í¬ë¡¤ (ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜)
6. ì—ëŸ¬ ì²˜ë¦¬ ë° fallback ë©”ì‹œì§€

### ğŸ”„ ì„œë²„ ì—°ë™ ëŒ€ê¸° ì¤‘

- ì‹¤ì œ ì„œë²„ ì‘ë‹µìœ¼ë¡œ êµì²´
- íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥ (í˜„ì¬ ë¹„í™œì„±í™”)
- ë™ì  chat_session_id ê´€ë¦¬
- **DrawerPage ê¸°ë¡ ëª©ë¡ API ì—°ë™**
- **í´ë” ê´€ë¦¬ API ì—°ë™**
- **ê¸°ë¡ ìƒì„¸/ìˆ˜ì •/ì‚­ì œ API ì—°ë™**

### ğŸš§ í•˜ë“œì½”ë”©ëœ ë°ì´í„° (ìˆ˜ì • í•„ìš”)

1. **DrawerPage**: ê¸°ë¡ ëª©ë¡ í•˜ë“œì½”ë”©
2. **FolderChangeModal**: í´ë” ëª©ë¡ í•˜ë“œì½”ë”©
3. **ChatPage**: ê°€ì§œ API ì‘ë‹µ ì‚¬ìš©
4. **FinishLoadingModal**: ê¸°ë¡ ì™„ë£Œ ì‘ë‹µ í•˜ë“œì½”ë”©

---

## ê¸°ìˆ  ìŠ¤íƒ

- **í”„ë¡ íŠ¸ì—”ë“œ**: React + Vite + styled-components
- **HTTP í´ë¼ì´ì–¸íŠ¸**: axios
- **íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €**: yarn

---

## ì°¸ê³ ì‚¬í•­

- ëª¨ë“  API í˜¸ì¶œì€ axiosë¥¼ ì‚¬ìš©
- ì—ëŸ¬ ë°œìƒ ì‹œ fallback ë©”ì‹œì§€ë¡œ ëŒ€ì²´
- ë¡œë”© ì¤‘ì—ëŠ” ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
- íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥ì€ í–¥í›„ êµ¬í˜„ ì˜ˆì •
- **í˜„ì¬ ë§ì€ ê¸°ëŠ¥ì´ í•˜ë“œì½”ë”©ëœ ë”ë¯¸ ë°ì´í„°ë¡œ êµ¬í˜„ë¨**
- **ë°±ì—”ë“œ API ì—°ë™ ì‹œ ë”ë¯¸ ë°ì´í„° ì œê±° í•„ìš”**
